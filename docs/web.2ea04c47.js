parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"wr89":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isEmptyObject=(t=>0===Object.entries(t).length&&t.constructor===Object),exports.wrapModulo=((t,e)=>(t%e+e)%e),exports.lineWrap=((t,e)=>{const r=t.match(/\S+/g)||[];if(0===r.length)return"";let n=[],l="";return r.forEach((t,o)=>{""===l&&t.length<=e?l=t:`${l} ${t}`.length<=e?l=`${l} ${t}`:t.length>e?(l.length>=e-1?(n.push(l),l=""):l+=" ",t.split("").forEach(t=>{`${l}${t}`.length<e?l+=t:(n.push(`${l}-`),l=t)})):(n.push(l),l=t),o===r.length-1&&n.push(l)}),(n=n.map(t=>{if(t.length===e)return t;let r="";for(let n=0;n<e-t.length;n++)r+=" ";return t+r})).join("\n")}),exports.expandString=((t,e,r)=>{const n=t.split("\n");let l="";return n.forEach(t=>{let n="";t.split("").forEach(t=>{for(let r=0;r<e;r++)n+=t}),n+="\n";for(let e=0;e<r;e++)l+=n}),l.replace(/\n$/,"")});
},{}],"kxG4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../underdash");class i{constructor(){}static initialize(t){if(!t||e.isEmptyObject(t))throw new Error("No dependencies supplied");i.dependencies=t}static resolve(e){if(!i.dependencies)throw new Error("Dependency container is not initialized");return i.dependencies[e]}}exports.default=i;
},{"../underdash":"wr89"}],"meEq":[function(require,module,exports) {
"use strict";var E;Object.defineProperty(exports,"__esModule",{value:!0}),function(E){E[E.T=1]="T",E[E.L=2]="L",E[E.L_INVERTED=3]="L_INVERTED",E[E.S=4]="S",E[E.S_INVERTED=5]="S_INVERTED",E[E.I=6]="I",E[E.BLOCK=7]="BLOCK",E[E.EMPTY_SPACE=8]="EMPTY_SPACE"}(E=exports.GAME_PIECE_TYPE||(exports.GAME_PIECE_TYPE={}));
},{}],"9+vi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const E=require("../gamePiece/enums");exports.WEB_ENV="WEB_ENV",exports.TERMINAL_ENV="TERMINAL_ENV",exports.TEST_ENV="TEST_ENV",exports.COLUMNS=10,exports.ROWS=16;const _={[exports.WEB_ENV]:{[E.GAME_PIECE_TYPE.L]:"l",[E.GAME_PIECE_TYPE.L_INVERTED]:"j",[E.GAME_PIECE_TYPE.S]:"s",[E.GAME_PIECE_TYPE.S_INVERTED]:"z",[E.GAME_PIECE_TYPE.T]:"t",[E.GAME_PIECE_TYPE.I]:"i",[E.GAME_PIECE_TYPE.BLOCK]:"o",[E.GAME_PIECE_TYPE.EMPTY_SPACE]:" "},[exports.TERMINAL_ENV]:{[E.GAME_PIECE_TYPE.L]:"l",[E.GAME_PIECE_TYPE.L_INVERTED]:"l",[E.GAME_PIECE_TYPE.S]:"s",[E.GAME_PIECE_TYPE.S_INVERTED]:"s",[E.GAME_PIECE_TYPE.T]:"t",[E.GAME_PIECE_TYPE.I]:"i",[E.GAME_PIECE_TYPE.BLOCK]:"o",[E.GAME_PIECE_TYPE.EMPTY_SPACE]:" "},[exports.TEST_ENV]:{[E.GAME_PIECE_TYPE.L]:"l",[E.GAME_PIECE_TYPE.L_INVERTED]:"l",[E.GAME_PIECE_TYPE.S]:"s",[E.GAME_PIECE_TYPE.S_INVERTED]:"s",[E.GAME_PIECE_TYPE.T]:"t",[E.GAME_PIECE_TYPE.I]:"i",[E.GAME_PIECE_TYPE.BLOCK]:"o",[E.GAME_PIECE_TYPE.EMPTY_SPACE]:" "}};exports.createGameCharSelector=(E=>{const P=_[E];return E=>P[E]});
},{"../gamePiece/enums":"meEq"}],"89Hz":[function(require,module,exports) {
"use strict";var t;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t[t.StartToGame=0]="StartToGame",t[t.GameToStart=1]="GameToStart",t[t.StartToOptions=2]="StartToOptions",t[t.OptionsToStart=3]="OptionsToStart",t[t.StartToHighScore=4]="StartToHighScore",t[t.HighScoreToStart=5]="HighScoreToStart",t[t.GameToHighScore=6]="GameToHighScore"}(t=exports.SceneTransition||(exports.SceneTransition={}));
},{}],"RLDF":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e.InputUp="InputUp",e.InputDown="InputDown",e.InputLeft="InputLeft",e.InputRight="InputRight",e.Confirmation="Confirmation",e.Pause="Pause",e.Rotate="Rotate",e.RotateReverse="RotateReverse",e.GravityDrop="GravityDrop",e.QuickDrop="QuickDrop",e.StartGravityInterval="StartGravityInterval",e.IncreaseGravityInterval="IncreaseGravityInterval",e.ClearGravityInterval="ClearGravityInterval",e.Restart="Restart",e.ToggleGhostPieceOption="ToggleGhostPieceOption",e.ToggleConsoleRenderingOption="ToggleConsoleRenderingOption",e.Render="Render"}(e=exports.EventType||(exports.EventType={}));
},{}],"1tBu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../underdash"),t=require("../eventDispatcher/enums"),n=(n,r,a,s)=>{let o=0;const c=()=>{let e="";return s&&(e+=`${s.trim()}\n\n`),r.forEach((t,n)=>{e+=n===o?`-> ${t.text()}\n`:`   ${t.text()}\n`}),{renderString:e,nextPieceString:"",score:0,level:1,clearedLines:0,options:a}};return n(c()),{handleEvent:a=>{switch(a.type){case t.EventType.InputDown:o=e.wrapModulo(o+1,r.length),n(c());break;case t.EventType.InputUp:o=e.wrapModulo(o-1,r.length),n(c());break;case t.EventType.Render:n(c());break;case t.EventType.Confirmation:case t.EventType.Rotate:case t.EventType.RotateReverse:r[o].action()}}}};exports.default=n;
},{"../underdash":"wr89","../eventDispatcher/enums":"RLDF"}],"BjO5":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../game/enums"),n=e(require("../menuTemplate")),r=e(require("../../dependencyContainer")),o=({changeScene:e,options:o})=>{const i=r.default.resolve("render"),a=[{text:()=>"Start game",action:()=>e(t.SceneTransition.StartToGame)},{text:()=>"Options",action:()=>e(t.SceneTransition.StartToOptions)},{text:()=>"High score",action:()=>e(t.SceneTransition.StartToHighScore)}];return n.default(i,a,o)};exports.default=o;
},{"../../game/enums":"89Hz","../menuTemplate":"1tBu","../../dependencyContainer":"kxG4"}],"8QOs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../eventDispatcher/enums"),t=(t,i,n,r)=>{let s,c;const a=t=>{const o=i.find(e=>e.transition===t);if(!o)throw new Error("No scene initializer found");s=o.initializer({changeScene:a,dispatch:n.dispatch,options:r}),c&&c(),c=n.register(s),n.dispatch({type:e.EventType.StartGravityInterval})};return s=t({changeScene:a,dispatch:n.dispatch,options:r}),c=n.register(s),{changeScene:a}};exports.default=t;
},{"../eventDispatcher/enums":"RLDF"}],"hCca":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../eventDispatcher/enums"),t=()=>{const t={ghostPieceActive:!0,consoleRenderingActive:!1},n={handleEvent:n=>{n.type===e.EventType.ToggleGhostPieceOption&&(t.ghostPieceActive=!t.ghostPieceActive),n.type===e.EventType.ToggleConsoleRenderingOption&&(t.consoleRenderingActive=!t.consoleRenderingActive)}};return{options:t,eventClient:n}};exports.default=t;
},{"../eventDispatcher/enums":"RLDF"}],"kWAF":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const E=require("./enums"),x=e(require("../dependencyContainer"));exports.getMinMaxCoordinates=(e=>{let E=Number.MAX_SAFE_INTEGER,x=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;return e.forEach(e=>{const{x:r,y:o}=e;r>y&&(y=r),r<E&&(E=r),o>t&&(t=o),o<x&&(x=o)}),[{x:E,y:x},{x:y,y:t}]}),exports.isLongestSideEven=(e=>{const[E,x]=exports.getMinMaxCoordinates(e),y=x.x-E.x+1,t=x.y-E.y+1;return(y>t?y:t)%2==0});const y=[];exports.getNextPieceType=(()=>{const e=[E.GAME_PIECE_TYPE.T,E.GAME_PIECE_TYPE.L,E.GAME_PIECE_TYPE.L_INVERTED,E.GAME_PIECE_TYPE.S,E.GAME_PIECE_TYPE.S_INVERTED,E.GAME_PIECE_TYPE.I,E.GAME_PIECE_TYPE.BLOCK];0===y.length&&e.forEach(e=>{y.push(e)});const x=Math.floor(Math.random()*y.length);return y.splice(x,1)[0]}),exports.getPieceChar=(e=>{const y=x.default.resolve("gameCharSelector");switch(e){case E.GAME_PIECE_TYPE.L:case E.GAME_PIECE_TYPE.L_INVERTED:case E.GAME_PIECE_TYPE.S:case E.GAME_PIECE_TYPE.S_INVERTED:case E.GAME_PIECE_TYPE.T:case E.GAME_PIECE_TYPE.I:case E.GAME_PIECE_TYPE.BLOCK:return y(e);default:throw new Error(`Unknown piece type - ${e}`)}}),exports.getInitialCoordinates=((e,x)=>{switch(e){case E.GAME_PIECE_TYPE.T:return[{x:x.x,y:x.y-1},{x:x.x-1,y:x.y},{x:x.x,y:x.y},{x:x.x+1,y:x.y}];case E.GAME_PIECE_TYPE.L:return[{x:x.x+1,y:x.y-1},{x:x.x-1,y:x.y},{x:x.x,y:x.y},{x:x.x+1,y:x.y}];case E.GAME_PIECE_TYPE.L_INVERTED:return[{x:x.x-1,y:x.y-1},{x:x.x-1,y:x.y},{x:x.x,y:x.y},{x:x.x+1,y:x.y}];case E.GAME_PIECE_TYPE.S:return[{x:x.x,y:x.y-1},{x:x.x+1,y:x.y-1},{x:x.x-1,y:x.y},{x:x.x,y:x.y}];case E.GAME_PIECE_TYPE.S_INVERTED:return[{x:x.x-1,y:x.y-1},{x:x.x,y:x.y-1},{x:x.x,y:x.y},{x:x.x+1,y:x.y}];case E.GAME_PIECE_TYPE.I:return[{x:x.x-1,y:x.y},{x:x.x,y:x.y},{x:x.x+1,y:x.y},{x:x.x+2,y:x.y}];case E.GAME_PIECE_TYPE.BLOCK:return[{x:x.x,y:x.y},{x:x.x+1,y:x.y},{x:x.x,y:x.y+1},{x:x.x+1,y:x.y+1}];default:throw new Error(`Unknown piece type - ${e}`)}}),exports.transpose=((e,E,x,y)=>({coordinates:e.map(e=>({x:e.x+x,y:e.y+y})),origo:{x:E.x+x,y:E.y+y}})),exports.getNextRotation=(e=>{const{coordinates:E,origo:x,reverse:y}=e;let t={x:x.x,y:x.y};const r=exports.isLongestSideEven(E);let o=E.map(e=>{const E=e.x<=t.x&&e.y<=t.y;return!r||E?{x:e.x,y:e.y}:{x:e.x>t.x?e.x+1:e.x,y:e.y>t.y?e.y+1:e.y}});return r&&(t={x:t.x+1,y:t.y+1}),o=o.map(e=>{const E=e.x-t.x,x=e.y-t.y;let r,o;return y?(r=x,o=-1*E):(r=-1*x,o=E),{x:t.x+r,y:t.y+o}}),r&&(t={x:t.x-1,y:t.y-1},o=o.map(e=>e.x<=t.x&&e.y<=t.y?e:{x:e.x>t.x?e.x-1:e.x,y:e.y>t.y?e.y-1:e.y})),{coordinates:o,origo:t}});
},{"./enums":"meEq","../dependencyContainer":"kxG4"}],"OK5E":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./utils"),t=require("../eventDispatcher/enums"),o=require("../config");exports.createGamePiece=(r=>{const n={x:2,y:2};let s=e.getInitialCoordinates(r,n),i={x:n.x,y:n.y};const[a]=e.getMinMaxCoordinates(s),c=e.transpose(s,i,o.COLUMNS/2-i.x-1,0-a.y);s=c.coordinates,i=c.origo;let u=e.getPieceChar(r),g=0;return{getNextState:o=>{const r=(o=>{switch(o){case t.EventType.InputLeft:return e.transpose(s,i,-1,0);case t.EventType.InputRight:return e.transpose(s,i,1,0);case t.EventType.InputUp:return e.transpose(s,i,0,-1);case t.EventType.InputDown:return e.transpose(s,i,0,1);case t.EventType.Rotate:{const t=e.getNextRotation({coordinates:s,origo:i,reverse:!1});return{coordinates:t.coordinates,origo:t.origo}}case t.EventType.RotateReverse:{const t=e.getNextRotation({coordinates:s,origo:i,reverse:!0});return{coordinates:t.coordinates,origo:t.origo}}case t.EventType.GravityDrop:return e.transpose(s,i,0,1);default:return{coordinates:s,origo:i}}})(o);return Object.assign({},r,{moves:g})},setState:e=>{null!==e.coordinates&&void 0!==e.coordinates&&(s=e.coordinates),null!==e.origo&&void 0!==e.origo&&(i=e.origo),null!==e.moves&&void 0!==e.moves&&(g=e.moves)},getState:()=>{return{coordinates:s,origo:i,moves:g}},getChar:()=>u,getPreview:()=>e.getInitialCoordinates(r,{x:0,y:0}),getType:()=>r}});
},{"./utils":"kWAF","../eventDispatcher/enums":"RLDF","../config":"9+vi"}],"xpO1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>1e3*Math.pow(.8-.007*(e-1),e-1);class t{constructor(){this._level=1,this._gravityInterval=e(this._level)}increaseLevel(){this._level<15&&(this._level+=1,this._gravityInterval=e(this._level))}setLevel(t){t>=1&&t<=15&&(this._level=t,this._gravityInterval=e(this._level))}getLevel(){return this._level}getGravityInterval(){return this._gravityInterval}}exports.default=t;
},{}],"XWkQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../underdash");exports.createName=(()=>{const r=["A","A","A"];let t=0;return{nextIndex:()=>{t=e.wrapModulo(t+1,r.length)},prevIndex:()=>{t=e.wrapModulo(t-1,r.length)},nextCharacter:()=>{if("Z"===r[t])return void(r[t]="A");const e=r[t].charCodeAt(0);r[t]=String.fromCharCode(e+1)},prevCharacter:()=>{if("A"===r[t])return void(r[t]="Z");const e=r[t].charCodeAt(0);r[t]=String.fromCharCode(e-1)},getName:()=>r.join("")}});
},{"../underdash":"wr89"}],"oHCv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../gamePiece/index"),r=require("../../gamePiece/enums"),a=require("../../gamePiece/utils"),o=require("../../config"),n=e(require("../../dependencyContainer")),i=require("../../eventDispatcher/enums"),s=e(require("./levelController")),c=require("../../game/enums"),v=require("../../highScore/name");var p;!function(e){e.Active="Active",e.GameOver="GameOver",e.Paused="Paused",e.HighScore="HighScore"}(p=exports.GameState||(exports.GameState={})),exports.initializeGameState=(({changeScene:e,dispatch:l,options:y})=>{const f=n.default.resolve("gameCharSelector"),S=n.default.resolve("render"),g=n.default.resolve("highScore"),u=f(r.GAME_PIECE_TYPE.EMPTY_SPACE);let d,h,E,m,T,x,G,b;const P=v.createName();function k(e){let t=!0;for(let r=0;r<e.length;r++){const a=e[r];if(a.x<0||a.x>=o.COLUMNS||a.y<0||a.y>=o.ROWS){t=!1;break}G[a.y][a.x]!==u&&(t=!1)}return t}function I(e){let t=!0;do{let r=e.getNextState(i.EventType.GravityDrop);if(void 0===r.moves)throw new Error("Expected to find property 'moves' on nextState");(t=k(r.coordinates))&&e.setState(Object.assign({},r,{moves:r.moves+1}))}while(t)}const C=()=>{S((()=>{const e=[];for(let a=0;a<o.ROWS;a++){e[a]=[];for(let t=0;t<o.COLUMNS;t++)e[a][t]=G[a][t]}d.getState().coordinates.forEach(t=>{e[t.y][t.x]=d.getChar()});let t="";for(let a=0;a<o.ROWS;a++){for(let r=0;r<o.COLUMNS;r++)t+=e[a][r];a<o.ROWS-1&&(t+="\n")}const r=E.getPreview();let n=[];r.forEach(e=>{n[e.y]||(n[e.y]=[]),n[e.y][e.x]=E.getChar()});let i="";const[s,c]=a.getMinMaxCoordinates(r);for(let a=s.y;a<=c.y;a++){for(let e=s.x;e<=c.x;e++)i+=n[a][e]||u;a<c.y&&(i+="\n")}return{renderString:t,nextPieceString:i,score:x,level:b.getLevel(),clearedLines:T,gameBoard:e,nextPiece:E,ghostPiece:y.ghostPieceActive?h:void 0,options:y,name:P}})(),m)};let O;const R=()=>{(()=>{b=new s.default;const e=a.getNextPieceType(),r=t.createGamePiece(e),n=t.createGamePiece(a.getNextPieceType());d=r,h=t.createGamePiece(e),E=n,m=p.Active,T=0,x=0,G=[];for(let t=0;t<o.ROWS;t++){G[t]=[];for(let e=0;e<o.COLUMNS;e++)G[t][e]=u}I(h)})(),C(),l({type:i.EventType.StartGravityInterval})};return R(),{handleEvent:r=>{switch(r.type){case i.EventType.Pause:m===p.Active?(m=p.Paused,l({type:i.EventType.ClearGravityInterval})):m===p.Paused&&(m=p.Active,l({type:i.EventType.StartGravityInterval}));break;case i.EventType.Restart:if(m!==p.GameOver)break;R();break;case i.EventType.StartGravityInterval:(e=>{O&&clearInterval(O),O=setInterval(()=>{l({type:i.EventType.GravityDrop}),C()},e)})(b.getGravityInterval());break;case i.EventType.ClearGravityInterval:null!==O&&clearInterval(O);break;case i.EventType.InputUp:m===p.HighScore&&P.nextCharacter();break;case i.EventType.InputLeft:case i.EventType.InputRight:case i.EventType.Rotate:case i.EventType.RotateReverse:{if(r.type===i.EventType.RotateReverse&&(m===p.Paused||m===p.GameOver))return void e(c.SceneTransition.GameToStart);if(r.type===i.EventType.InputLeft&&m===p.HighScore&&P.prevIndex(),r.type===i.EventType.InputRight&&m===p.HighScore&&P.nextIndex(),m!==p.Active)break;let t=d.getNextState(r.type);if(k(t.coordinates)){d.setState(t),h.setState(t),I(h);break}if(r.type===i.EventType.Rotate||r.type===i.EventType.RotateReverse){const e=[1,2,-1,-2];for(const o of e){const e=a.transpose(t.coordinates,t.origo,o,0);if(k(e.coordinates)){d.setState(e),h.setState(e),I(h);break}}const r=[1];for(const o of r){const e=a.transpose(t.coordinates,t.origo,0,o);if(k(e.coordinates)){d.setState(e),h.setState(e),I(h);break}}}break}case i.EventType.QuickDrop:if(m!==p.Active)break;let n;l({type:i.EventType.StartGravityInterval});let s=!0,v=0;do{if(void 0===(n=d.getNextState(i.EventType.GravityDrop)).moves)throw new Error("Expected to find property 'moves' on nextState");(s=k(n.coordinates))&&(d.setState(Object.assign({},n,{moves:n.moves+1})),v+=1)}while(s);x+=2*v,l({type:i.EventType.GravityDrop});break;case i.EventType.InputDown:case i.EventType.GravityDrop:{if(r.type===i.EventType.InputDown&&m===p.HighScore){P.prevCharacter();break}if(m!==p.Active)break;l({type:i.EventType.StartGravityInterval});const e=d.getNextState(r.type);if(void 0===e.moves)throw new Error("Expected to find property 'moves' on nextState");if(k(e.coordinates))d.setState(Object.assign({},e,{moves:e.moves+1}));else{if(0===e.moves){l({type:i.EventType.ClearGravityInterval}),m=g.isHighScore(x)?p.HighScore:p.GameOver;break}d.getState().coordinates.forEach(e=>{G[e.y][e.x]=d.getChar()});const r=[];for(let e=o.ROWS-1;e>=0;e--){let t=!0;for(let r=0;r<o.COLUMNS;r++)if(G[e][r]===u){t=!1;break}t&&r.push(e)}if(r.forEach(e=>{for(let t=0;t<o.COLUMNS;t++)G[e][t]=u}),r.length>0)for(let e=r[0]-1;e>=0;e--)for(let t=0;t<o.COLUMNS;t++)if(G[e][t]!==u){const a=G[e][t],o=r.filter(t=>t>e).length;let n=e,i=!0;for(;i&&n<e+o;)G[n+1][t]===u?n++:i=!1;e!==n&&(G[e][t]=u,G[n][t]=a)}let n=0;const s=b.getLevel();switch(r.length){case 0:break;case 1:n+=100*s;break;case 2:n+=300*s;break;case 3:n+=500*s;break;case 4:n+=800*s;break;default:throw new Error("We shouldn't be able to clear more than 4 lines in one play..")}x+=n,r.forEach(()=>{T+=1}),b.setLevel(Math.floor(T/15)+1),l({type:i.EventType.StartGravityInterval});const c=t.createGamePiece(a.getNextPieceType());I(h=t.createGamePiece(E.getType())),d=E,E=c}break}case i.EventType.Confirmation:if(m===p.HighScore)return g.save({name:P.getName(),value:x}),void e(c.SceneTransition.GameToHighScore)}C()}}});
},{"../../gamePiece/index":"OK5E","../../gamePiece/enums":"meEq","../../gamePiece/utils":"kWAF","../../config":"9+vi","../../dependencyContainer":"kxG4","../../eventDispatcher/enums":"RLDF","./levelController":"xpO1","../../game/enums":"89Hz","../../highScore/name":"XWkQ"}],"noH9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../game/enums"),n=e(require("../menuTemplate")),o=e(require("../../dependencyContainer")),r=require("../../eventDispatcher/enums"),i=e=>{const{changeScene:i,dispatch:s,options:c}=e,p=o.default.resolve("render"),a=[{text:()=>`Ghost pieces - ${c.ghostPieceActive?"on":"off"}`,action:()=>{s({type:r.EventType.ToggleGhostPieceOption}),s({type:r.EventType.Render})}},{text:()=>`Console rendering - ${c.consoleRenderingActive?"on":"off"}`,action:()=>{s({type:r.EventType.ToggleConsoleRenderingOption}),s({type:r.EventType.Render})}},{text:()=>"Back to start screen",action:()=>i(t.SceneTransition.OptionsToStart)}];return n.default(p,a,c)};exports.default=i;
},{"../../game/enums":"89Hz","../menuTemplate":"1tBu","../../dependencyContainer":"kxG4","../../eventDispatcher/enums":"RLDF"}],"yEUw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../game/enums"),r=e(require("../menuTemplate")),n=e(require("../../dependencyContainer")),a=e=>{const{changeScene:a,dispatch:o,options:u}=e,i=n.default.resolve("highScore").load(),s=n.default.resolve("render"),c=[{text:()=>"Back",action:()=>a(t.SceneTransition.HighScoreToStart)}],l=i.map((e,t)=>`${t+1} - ${e.name} ${e.value}`).join("\n");return r.default(s,c,u,l)};exports.default=a;
},{"../../game/enums":"89Hz","../menuTemplate":"1tBu","../../dependencyContainer":"kxG4"}],"nnU0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=()=>{let e=[],t=0;return{register:r=>{const s=t;return t+=1,e.push(Object.assign({},r,{id:s})),()=>(t=>{e=e.filter(e=>e.id!==t)})(s)},dispatch:t=>{e.forEach(e=>{e.handleEvent(t)})}}};exports.default=e;
},{}],"Ztbj":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=e(require("../dependencyContainer")),t=e(require("../scenes/menu")),n=e(require("../scenes/sceneController")),r=e(require("../options")),a=require("./enums"),s=require("../scenes/gameState"),o=e(require("../scenes/options")),u=e(require("../scenes/highScore")),l=e(require("../eventDispatcher")),c=()=>{const e=i.default.resolve("setupInputListeners"),c=[{transition:a.SceneTransition.StartToGame,initializer:s.initializeGameState},{transition:a.SceneTransition.StartToOptions,initializer:o.default},{transition:a.SceneTransition.OptionsToStart,initializer:t.default},{transition:a.SceneTransition.GameToStart,initializer:t.default},{transition:a.SceneTransition.StartToHighScore,initializer:u.default},{transition:a.SceneTransition.HighScoreToStart,initializer:t.default},{transition:a.SceneTransition.GameToHighScore,initializer:u.default}],d=l.default(),S=r.default();d.register(S.eventClient),n.default(t.default,c,d,S.options);e({handleInput:e=>{d.dispatch({type:e})}})};exports.default=c;
},{"../dependencyContainer":"kxG4","../scenes/menu":"BjO5","../scenes/sceneController":"8QOs","../options":"hCca","./enums":"89Hz","../scenes/gameState":"oHCv","../scenes/options":"noH9","../scenes/highScore":"yEUw","../eventDispatcher":"nnU0"}],"ZQK0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t,e,i,r=1){if(this.withinColorRange=(t=>(t.forEach(t=>{if(t<0||t>255)return!1}),!0)),this.withinAlphaRange=(t=>t>=0&&t<=1),!this.withinColorRange([t,e,i])||!this.withinAlphaRange(r))throw new Error("Invalid values supplied to Color constructor");this.red=t,this.green=e,this.blue=i,this.alpha=r}toString(){return`rgb(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`}setAlpha(e){if(!this.withinAlphaRange(e))throw new Error("Invalid alpha value supplied to setAlpha method");return new t(this.red,this.green,this.blue,e)}}exports.default=t;
},{}],"FsWR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../underdash"),n=require("../scenes/gameState"),t=require("../config"),r=require("../gamePiece/enums"),l=4,o=2,s=t.createGameCharSelector(t.TERMINAL_ENV),a=s(r.GAME_PIECE_TYPE.EMPTY_SPACE),i=(t,r)=>{const{renderString:l,nextPieceString:o,score:s,level:i,gameBoard:c,ghostPiece:g}=t;if(!l)throw new Error("No render string supplied");let p=l;if(c){let n=[];g&&(n=g.getState().coordinates),p="";for(let e=0;e<c.length;e++){for(let t=0;t<c[0].length;t++){let r=c[e][t];for(const l of n)l.x===t&&l.y===e&&r===a&&(r=".");p+=r}e<c.length-1&&(p+="\n")}p=e.expandString(p,4,2)}const u=(n,t)=>{const r=n.split("\n");let l=0;r.forEach(e=>{e.length>l&&(l=e.length)});const o=l/2-10;let s=e.lineWrap(t,16);const a=s.split("\n").length;s=s.split("\n").join("");const i=a+2+2;return r.map((e,n)=>{if(10===n||n===10+i-1)return e.split("").map((e,n)=>n===o||n===o+20-1?"+":n>=o&&n<o+20?"-":e).join("");const t=n<12||n>=10+i-1-1;return n>10&&n<10+i-1?e.split("").map((e,n)=>{if(n===o||n===o+20-1)return"|";if(n>=o&&n<o+20){const e=n<o+1+1||n>=o+20-1-1;if(t||e||0===s.length)return" ";const r=s[0];return s=s.substring(1),r}return e}).join(""):e}).join("\n")};let d=p;r&&r===n.GameState.GameOver&&(d=u(d,"Game over! Press 'r' to play again.")),r&&r===n.GameState.Paused&&(d=u(d,"Game paused"));let h="";h+=`level: ${i}\n`,h+=`score: ${s}\n`,h+="next:\n",h+=e.expandString(((n,t)=>{const r=n.split("\n").length;return r>=t?n:`${n}${e.expandString("\n",t-r,1)}`})(`${o}\n`,3),4,2),h+="{{replace-me}}\n";const f=(h+=d).split("\n");let m=0;f.forEach(e=>{e.length>m&&(m=e.length)});let S="";S+="+",S+=e.expandString("-",m,1),S+="+\n",f.forEach(n=>{const t=n.length;let r="";t<m&&(r=e.expandString(" ",m-t,1)),n.includes("{{replace-me}}")?S+=`+${e.expandString("-",m,1)}+\n`:S+=`|${n}${r}|\n`}),S+="+",S+=e.expandString("-",m,1),S+="+\n",console.clear?console.clear():console.log("[2J"),console.log(S)};exports.default=i;
},{"../underdash":"wr89","../scenes/gameState":"oHCv","../config":"9+vi","../gamePiece/enums":"meEq"}],"yJmQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../gamePiece/enums"),n=require("../gamePiece/utils"),r=require("../config"),o=require("../scenes/gameState"),l=e(require("./color")),i=require("../underdash"),a=e(require("./terminal")),s=new l.default(171,0,235),c=new l.default(252,158,0),f=new l.default(45,0,248),u=new l.default(0,254,0),d=new l.default(255,0,0),E=new l.default(0,185,224),g=new l.default(237,247,0),S=()=>{const e=r.createGameCharSelector(r.WEB_ENV),S=e(t.GAME_PIECE_TYPE.EMPTY_SPACE),h=e(t.GAME_PIECE_TYPE.T),m=e(t.GAME_PIECE_TYPE.L),w=e(t.GAME_PIECE_TYPE.L_INVERTED),_=e(t.GAME_PIECE_TYPE.S),P=e(t.GAME_PIECE_TYPE.S_INVERTED),p=e(t.GAME_PIECE_TYPE.I),x=e(t.GAME_PIECE_TYPE.BLOCK),C=e=>{switch(e){case h:return s;case m:return c;case w:return f;case _:return u;case P:return d;case p:return E;case x:return g;default:return new l.default(255,255,255)}},T=document.getElementById("canvas");if(!T)throw new Error("Could not find canvas element");const G=T.getContext("2d");if(!G)throw new Error("Could not find context element");const y=window.innerHeight-50,M=y/2;G.canvas.height=y,G.canvas.width=M;const A=M/r.COLUMNS,I=A,R=y-r.ROWS*I;return(e,t)=>{const{renderString:r,gameBoard:s,nextPiece:c,score:f,level:u,ghostPiece:d,clearedLines:E,options:g,name:h}=e;if(g&&g.consoleRenderingActive?a.default(e,t):console.clear(),!r)throw new Error("Render string was not supplied to render function");G.clearRect(0,0,M,y),G.fillStyle=new l.default(255,255,255,.25).toString(),G.fillRect(0,R,M,y-R);const m=e=>{const t=A,n=2*I,r=A,o=(M-2*t-2*r)/(A/2),a=i.lineWrap(e,o).split("\n"),s=2*I+I*a.length;G.fillStyle=new l.default(0,0,0,.5).toString(),G.fillRect(t,R+n,M-2*t,s),G.fillStyle=new l.default(255,255,255).toString();const c=A/2;G.font=`${c}px monospace`;const f=I;for(let l=0;l<a.length;l++){const e=a[l];for(let o=0;o<e.length;o++)G.fillText(e.charAt(o),t+r+o*(A/3),R+n+c+r+l*f)}};(()=>{if(c){const e=A/2,t=I/2,r=M-5*e,o=0;G.fillStyle=new l.default(0,0,0).toString(),G.font="18px monospace",G.fillText("Next:",r-60,o+20);const i=C(c.getChar());G.fillStyle=i.toString();const{coordinates:a,origo:s}=c.getState(),[f]=n.getMinMaxCoordinates(a);n.transpose(a,s,-1*f.x,0).coordinates.forEach(n=>{const{x:l,y:i}=n;G.fillRect(r+e*l,o+t*i,e,t)})}})(),(()=>{if(d){const e=C(d.getChar()).setAlpha(.15);G.fillStyle=e.toString(),d.getState().coordinates.forEach(({x:e,y:t})=>{G.fillRect(0+e*A,R+t*I,A,I)})}})(),(()=>{if(s)for(let e=0;e<s.length;e++)for(let t=0;t<s[0].length;t++){const n=s[e][t];if(n!==S){const r=C(n);G.fillStyle=r.toString(),G.fillRect(0+t*A,R+e*I,A,I),G.strokeStyle=new l.default(0,0,0).toString(),G.lineWidth=1,G.strokeRect(0+t*A,R+e*I,A,I)}}})(),t&&(()=>{const e=new l.default(0,0,0).toString();G.fillStyle=e,G.font="18px monospace",G.fillText(`Level: ${u}`,0,20),G.fillText(`Score: ${f}`,0,45),G.fillText(`Cleared lines: ${E}`,0,70)})(),t||(()=>{const e=new l.default(0,0,0).toString();G.fillStyle=e,G.font="18px monospace";const t=r.split("\n");G.font="16px monospace";const n=I;for(let r=0;r<t.length;r++)G.fillText(t[r],A,R+2*I+r*n)})(),t&&t===o.GameState.GameOver&&m("Game over!\n(r) restart\n(q) quit"),t&&t===o.GameState.HighScore&&m(`High score! ${f}\n${h&&h.getName()}`),t&&t===o.GameState.Paused&&m('Game paused. Press "q" to exit to menu.')}};exports.default=S;
},{"../gamePiece/enums":"meEq","../gamePiece/utils":"kWAF","../config":"9+vi","../scenes/gameState":"oHCv","./color":"ZQK0","../underdash":"wr89","./terminal":"FsWR"}],"YSSF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../eventDispatcher/enums"),t=t=>{const{handleInput:n}=t;let o=[];function p(){const t=o[0],p=o[o.length-1],u=function(t,n,o){return 0===t&&0===n?o>window.innerWidth/2?e.EventType.Rotate:e.EventType.RotateReverse:Math.abs(t)>Math.abs(n)?t>0?e.EventType.InputRight:e.EventType.InputLeft:n>200?(console.log(n),e.EventType.QuickDrop):n>0?e.EventType.InputDown:e.EventType.InputUp}(p.pageX-t.pageX,p.pageY-t.pageY,p.clientX);n(u),o=[]}const u=document.getElementById("wrapper");if(!u)throw new Error("Element did not exist");u.addEventListener("touchstart",function(e){o.push(e.touches[0])},!1),u.addEventListener("touchend",p,!1),u.addEventListener("touchcancel",function(){p()},!1),u.addEventListener("touchmove",function(e){o.push(e.touches[0])},!1),u.addEventListener("keydown",function(t){const o={37:e.EventType.InputLeft,39:e.EventType.InputRight,38:e.EventType.InputUp,40:e.EventType.InputDown,69:e.EventType.Rotate,81:e.EventType.RotateReverse,87:e.EventType.QuickDrop,32:e.EventType.GravityDrop,13:e.EventType.Confirmation,82:e.EventType.Restart,27:e.EventType.Pause};void 0!==o[t.keyCode]&&n(o[t.keyCode])},!1)};exports.default=t;
},{"../eventDispatcher/enums":"RLDF"}],"2tB/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e="high_scores",t=e=>{const t=localStorage.getItem("high_scores");if(null===t)return void localStorage.setItem("high_scores",JSON.stringify([e]));let s=JSON.parse(t);s.push(e),s.sort((e,t)=>t.value-e.value),s.length>10&&s.splice(10),localStorage.setItem("high_scores",JSON.stringify(s))},s=()=>{const e=localStorage.getItem("high_scores");return null===e?[]:JSON.parse(e)},r=e=>{const t=s();return t.length<10||e>Math.min(...t.map(e=>e.value))},o={save:t,load:s,isHighScore:r};exports.default=o;
},{}],"sC8V":[function(require,module,exports) {

},{}],"g5I+":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"APRZ":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0});const t=require("readline"),n=require("../eventDispatcher/enums"),r=r=>{const{handleInput:s}=r;if(t.emitKeypressEvents(e.stdin),void 0===e||void 0===e.stdin||void 0===e.stdin.setRawMode)throw new Error("Unexpected undefined object");e.stdin.setRawMode(!0),e.stdin.on("keypress",(t,r)=>{if(r.ctrl&&"c"===r.name)e.exit();else switch(r.name){case"left":s(n.EventType.InputLeft);break;case"right":s(n.EventType.InputRight);break;case"up":s(n.EventType.InputUp);break;case"down":s(n.EventType.InputDown);break;case"q":s(n.EventType.RotateReverse);break;case"e":s(n.EventType.Rotate);break;case"r":s(n.EventType.Restart);break;case"w":s(n.EventType.QuickDrop);break;case"return":s(n.EventType.Confirmation);break;case"escape":s(n.EventType.Pause)}})};exports.default=r;
},{"readline":"sC8V","../eventDispatcher/enums":"RLDF","process":"g5I+"}],"ZHoT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});let e=[];const t=()=>e,s=t=>{const s=e;s.push(t),s.sort((e,t)=>t-e),s.length>10&&s.splice(10),e=s},o=e=>{const s=t();return e>Math.min(...s)},r={save:s,load:t,isHighScore:o};exports.default=r;
},{}],"9B6d":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,i){return new(t||(t=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(r){o(r)}}function u(e){try{l(i.throw(e))}catch(r){o(r)}}function l(e){e.done?n(e.value):new t(function(r){r(e.value)}).then(a,u)}l((i=i.apply(e,r||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},t=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r};Object.defineProperty(exports,"__esModule",{value:!0});const i=r(require("./dependencyContainer")),n=require("./config"),o=r(require("./game"));exports.main=(r=>e(this,void 0,void 0,function*(){let e;switch(r){case n.WEB_ENV:e={render:(yield Promise.resolve().then(()=>t(require("./render/web")))).default(),setupInputListeners:(yield Promise.resolve().then(()=>t(require("./input/web")))).default,gameCharSelector:n.createGameCharSelector(n.WEB_ENV),highScore:(yield Promise.resolve().then(()=>t(require("./highScore/web")))).default};break;case n.TERMINAL_ENV:e={render:(yield Promise.resolve().then(()=>t(require("./render/terminal")))).default,setupInputListeners:(yield Promise.resolve().then(()=>t(require("./input/terminal")))).default,gameCharSelector:n.createGameCharSelector(n.TERMINAL_ENV),highScore:(yield Promise.resolve().then(()=>t(require("./highScore/terminal")))).default};break;default:throw new Error(`Unknown game environment - ${r}`)}i.default.initialize(e),o.default()}));
},{"./dependencyContainer":"kxG4","./config":"9+vi","./game":"Ztbj","./render/web":"yJmQ","./input/web":"YSSF","./highScore/web":"2tB/","./render/terminal":"FsWR","./input/terminal":"APRZ","./highScore/terminal":"ZHoT"}],"65v2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./index"),r=require("./config");e.main(r.WEB_ENV);
},{"./index":"9B6d","./config":"9+vi"}]},{},["65v2"], null)
//# sourceMappingURL=web.2ea04c47.js.map